<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>PyVolvelle Editor</title>

    <script src="vendor/brython.js"></script>
    <script src="vendor/brython_stdlib.js"></script>
    <script src="vendor/codemirror.js"></script>
  </head>

  <body onload="brython(1)">
    <div class="editor" style="position: absolute; top: 0; left: 0; width: 50%; height: 100%"></div>
    <div class="preview" style="position: absolute; top: 0; left: 51%; width: 50%; height: 100%; background-color: green"></div>

    <script>
     const defaultCode = `
from volvelle import *

class Names(Volvelle):
    def __init__(self):
        self.firstname = OneOf()

    def lastname(self):
        if self.firstname == "Omar":
            return "Rizwan"
        elif self.firstname == "Max":
            return "Krieger"
        elif self.firstname == "Ian":
            return "Clester"
        elif self.firstname == "Andrew":
            return "Blinn"

Names().render()
`;
     const {basicSetup} = CM["codemirror"];
     const {EditorView, keymap} = CM["@codemirror/view"];
     const {EditorState} = CM["@codemirror/state"];
     const {python} = CM["@codemirror/lang-python"];

     const liveReload = EditorView.updateListener.of(e => {
       const code = e.state.doc.toString();
       window.code = code;
       try {
         eval(__BRYTHON__.python_to_js(code));
       } catch (e) {
         console.error(e);
       }
     });

     const view = new EditorView({
       doc: defaultCode,
       extensions: [basicSetup, python(), liveReload],
       parent: document.getElementsByClassName("editor")[0]
     });
    </script>
  </body>
</html>
